<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Players - Gestión de Jugadores</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome CDN for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom Styles -->
    <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
    <!-- Insert Navigation Bar Fragment -->
    <th:block th:replace="~{fragments/layout :: navbar}"></th:block>

    <!-- Insert Page Header Fragment -->
    <th:block th:replace="~{fragments/layout :: pageHeader(
        title='<i class=\"fas fa-users\"></i> Gestión de Jugadores NBA',
        subtitle='Administra el catálogo completo de jugadores de la NBA',
        showCreateButton=true
    )}"></th:block>

    <!-- Main Content -->
    <div class="container-lg py-4">
        <!-- Search Form Section -->
        <div class="row mb-4">
            <div class="col-12">
                <form method="GET" th:action="@{/players}" class="card search-form-card">
                    <div class="card-body">
                        <div class="row g-3 align-items-center">
                            <div class="col-md-9">
                                <!-- Search Input: Uses @RequestParam 'searchName' to filter players by name -->
                                <input type="text" name="searchName" class="form-control" placeholder="Buscar jugador por nombre..." 
                                    th:value="${searchName != null ? searchName : ''}">
                            </div>
                            <div class="col-md-3 d-flex gap-2">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                                <a th:href="@{/players}" class="btn btn-secondary w-100">
                                    <i class="fas fa-redo"></i> Limpiar
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- Statistics Section -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${#lists.size(players)}">0</div>
                        <div class="stat-label">Jugadores Totales</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${#lists.size(players.?[active == true])}">0</div>
                        <div class="stat-label">Jugadores Activos</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${#lists.size(players.?[active == false])}">0</div>
                        <div class="stat-label">Jugadores Inactivos</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${teams != null ? #lists.size(teams) : '—'}">0</div>
                        <div class="stat-label">Equipos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Players Cards Grid -->
        <div th:if="${not #lists.isEmpty(players)}" class="row g-4">
            <div class="col-lg-4 col-md-6" th:each="player : ${players}">
                <div class="card player-card">
                    <!-- Player Photo -->
                    <img th:if="${player.photoUrl}" th:src="${player.photoUrl}" alt="Player Photo" class="player-card-image">
                    <div th:unless="${player.photoUrl}" class="player-card-image-placeholder">
                        <i class="fas fa-user"></i>
                    </div>

                    <!-- Card Header with Player Name -->
                    <div class="player-card-header">
                        <h5 th:text="${player.name}">Nombre Jugador</h5>
                        <small class="text-white-50" th:text="${player.team}">Equipo</small>
                        <div class="jersey-badge" th:text="${player.jerseyNumber != null ? player.jerseyNumber : 'N/A'}">00</div>
                    </div>

                    <!-- Card Body with Player Details -->
                    <div class="player-card-body">
                        <!-- Status Badge -->
                        <div class="mb-3">
                            <span th:if="${player.active}" class="status-badge status-active">
                                <i class="fas fa-check-circle"></i> Activo
                            </span>
                            <span th:unless="${player.active}" class="status-badge status-inactive">
                                <i class="fas fa-times-circle"></i> Inactivo
                            </span>
                        </div>

                        <!-- Player Information -->
                        <div class="player-info">
                            <span class="player-info-label">País:</span>
                            <span class="player-info-value" th:text="${player.countryOfOrigin != null ? player.countryOfOrigin : 'N/A'}">-</span>
                        </div>

                        <div class="player-info">
                            <span class="player-info-label">Nacimiento:</span>
                            <span class="player-info-value" th:text="${player.birthDate != null ? #temporals.format(player.birthDate, 'dd/MM/yyyy') : 'N/A'}">-</span>
                        </div>

                        <!-- Position Info -->
                        <div th:if="${player.position != null}" class="player-info">
                            <span class="player-info-label">Posición:</span>
                            <span class="player-info-value" th:text="${player.position.description}">-</span>
                        </div>

                        <!-- Body Measurements Info -->
                        <div th:if="${player.bodyMeasurements != null}" class="player-info">
                            <span class="player-info-label">Altura:</span>
                            <span class="player-info-value" th:text="${player.bodyMeasurements.heightCm != null ? player.bodyMeasurements.heightCm + ' cm' : 'N/A'}">-</span>
                        </div>

                        <!-- Season Statistics Summary -->
                        <div th:if="${player.seasonStatistics != null && player.seasonStatistics.pointsPerGame != null}" class="player-info">
                            <span class="player-info-label">PPG:</span>
                            <span class="player-info-value" th:text="${#numbers.formatDecimal(player.seasonStatistics.pointsPerGame, 1, 1)}">0.0</span>
                        </div>
                    </div>

                    <!-- Card Footer with Actions -->
                    <div class="player-card-footer">
                        <a th:href="@{/players/{id}(id=${player.id})}" class="btn btn-view btn-sm-custom" title="Ver detalles">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                        <a th:href="@{/players/{id}/edit(id=${player.id})}" class="btn btn-edit btn-sm-custom" title="Editar">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <button type="button" class="btn btn-delete btn-sm-custom" th:data-player-id="${player.id}" 
                            th:data-player-name="${player.name}" data-bs-toggle="modal" data-bs-target="#deleteModal" title="Eliminar">
                            <i class="fas fa-trash"></i> Borrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${#lists.isEmpty(players)}" class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>No hay jugadores registrados</h3>
            <p>Comienza agregando un nuevo jugador a la base de datos.</p>
            <a th:href="@{/players/new}" class="btn btn-create">
                <i class="fas fa-plus-circle"></i> Crear Primer Jugador
            </a>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que deseas eliminar al jugador <strong id="playerNameModal">-</strong>?</p>
                    <p class="text-muted small mb-0">Esta acción <strong>no se puede deshacer</strong>.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> No, Cancelar
                    </button>
                    <form id="deleteForm" method="POST" class="delete-form-inline">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Sí, Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Fragment -->
    <th:block th:replace="~{fragments/layout :: footer}"></th:block>

    <!-- Bootstrap 5 JS Bundle CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Scripts -->
    <script src="/js/modal.js"></script>
</body>
</html>
